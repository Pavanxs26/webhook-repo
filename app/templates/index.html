<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Activity Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-3xl mx-auto">
        <h1 class="text-2xl font-bold mb-6 text-gray-800">Latest Repository Changes</h1>
        
        <div id="events" class="space-y-4">
            <p class="text-gray-500">Loading activity...</p>
        </div>
    </div>

    <script>
        async function fetchEvents() {
            try {
                const response = await fetch("/webhook/receiver_data");
                const data = await response.json();
                const container = document.getElementById("events");
                
                if (data.length === 0) {
                    container.innerHTML = "<p class='text-gray-500'>No activity found in MongoDB.</p>";
                    return;
                }

                container.innerHTML = "";

                data.forEach(e => {
                    const date = new Date(e.timestamp).toLocaleString();
                    let text = "";
                    
                    if(e.action === "PUSH") 
                        text = `"${e.author}" pushed to "${e.to_branch}" on ${date}`;
                    else if(e.action === "PULL_REQUEST")
                        text = `"${e.author}" submitted a pull request from "${e.from_branch}" to "${e.to_branch}" on ${date}`;
                    else if(e.action === "MERGE")
                        text = `"${e.author}" merged branch "${e.from_branch}" to "${e.to_branch}" on ${date}`;
                    
                    const div = document.createElement("div");
                    div.className = "p-4 bg-white rounded shadow-sm border-l-4 border-blue-500 font-medium text-gray-700";
                    div.innerText = text;
                    container.appendChild(div);
                });
            } catch (err) {
                console.error("Error fetching data:", err);
            }
        }

        // Poll every 15 seconds per assessment requirement
        setInterval(fetchEvents, 15000); 
        fetchEvents();
    </script>
</body>
</html>